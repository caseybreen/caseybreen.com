start_year = start_year,
window_width = window_width,
n = nrow(sim_data_trunc))
data <- bind_rows(results) %>%
ungroup() %>%
mutate(t = coef/se) %>%
mutate(se = se/0.0240,
t = t / 41.08333,
coef = coef/0.986)
plota <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = se)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "SE / SE (untruncated)",
caption = "") +
theme(legend.position = "bottom")
plotb <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = coef)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "Coef / Coef (untruncated)",
title = "OLS under truncation ") +
theme(legend.position = "bottom")
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom")
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
plot_sim
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom",
legend.key.width=unit(3,"cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
## save plot
ggsave(plot_sim, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
plota <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = se)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "SE / SE (untruncated)",
caption = "") +
theme(legend.position = "bottom",
legend.key.width=unit(2,"cm"))
plotb <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = coef)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "Coef / Coef (untruncated)",
title = "OLS under truncation ") +
theme(legend.position = "bottom",
legend.key.width=unit(2,"cm"))
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom",
legend.key.width=unit(2,"cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
v
plot_sim
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
## save plot
ggsave(plot_sim, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
plota <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = se)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "SE / SE (untruncated)",
caption = "") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
plotb <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = coef)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "Coef / Coef (untruncated)",
title = "OLS under truncation ") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
## save plot
ggsave(plot_sim, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
plot_sim <- plot_sim +
labs(title = "Test")
plot_sim
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 7)
)
plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
plota <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = se)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "SE / SE (untruncated)",
caption = "") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
plotb <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = coef)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "Coef / Coef (untruncated)",
title = "") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5,"cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 7)
)
plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
size = 12
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 7)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
size = 40
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 7)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
size = 20
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 7)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
size = 20
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = -3,
size = 20
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = 3,
size = 20
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
set.seed(5)
results <- list()
i = 1
for (start_year in c(1865:1880)) for (window_width in c(1:30)) {
sim_data <- gompertztrunc::gompertztrunc_simu(n=200000, formula = death_age ~ sex, coefs = c('sex'=-0.2), dummy=c(TRUE)) %>%
mutate(byear = 1800) %>%
mutate(dyear = byear + floor(death_age))
sim_data_trunc <- sim_data %>%
filter(dyear >= start_year & dyear <= start_year + window_width)
adj_factor <- 200000/nrow(sim_data_trunc)
sim_data <- gompertztrunc::gompertztrunc_simu(n = adj_factor*200000, formula = death_age ~ sex, coefs = c('sex'=-0.2), dummy=c(TRUE)) %>%
mutate(byear = 1800) %>%
mutate(dyear = byear + floor(death_age))
sim_data_trunc <- sim_data %>%
filter(dyear >= start_year & dyear <= start_year + window_width)
lm_model <- lm(death_age~sex, data = sim_data_trunc)
results[[i]] <- tibble(coef = summary(lm_model)$coefficients["sex","Estimate"],
se = summary(lm_model)$coefficients["sex","Std. Error"],
start_year = start_year,
window_width = window_width,
n = nrow(sim_data_trunc))
i = i + 1
cat(i)
}
plota <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = se)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "SE / SE (untruncated)",
title = "Standard Errror",
caption = "") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5, "cm"))
plotb <- ggplot(data, aes(x = start_year - 1800 , y = window_width)) +
geom_tile(aes(fill = coef)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "Coef / Coef (untruncated)",
title = "Regression Coefficient") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5, "cm"))
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5, "cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = 3,
size = 25
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)",
tite = "T-Statistic") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5, "cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = 3,
size = 25
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = 2.5,
size = 22
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
sim_data
sim_data %>% count()
lm_model2
adj_factor
adj_factor*200000
plotc <- ggplot(data, aes(x = start_year - 1800, y =  window_width )) +
geom_tile(aes(fill = t)) +
# scale_fill_distiller(palette = "YlGnBu") +
scale_fill_viridis_c(option = "magma") +
cowplot::theme_minimal_hgrid(15) +
labs(y = "Width of Window (Years)",
x = "Starting Age",
fill = "T-Stat / T-Stat (untruncated)",
title = "T-Statistic") +
theme(legend.position = "bottom",
legend.key.width=unit(2.5, "cm"))
## create plot
plot_sim <- cowplot::plot_grid(plotb, plota, plotc, ncol = 1, labels = "auto")
title <- ggdraw() +
draw_label(
"OLS under Double-Truncation",
fontface = 'bold',
x = 0,
hjust = 0,
vjust = 2.5,
size = 22
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_sim_title <- plot_grid(
title, plot_sim,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.1, 1)
)
## save plot
ggsave(plot_sim_title, filename = "../figures/simulated_window_widths.pdf", height = 17, width = 10)
